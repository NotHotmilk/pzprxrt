/*! @license pzpr.js v1375cc80 (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */
!function(e,t){"object"==typeof module&&module.exports?module.exports=[e,t]:pzpr.classmgr.makeCustom(e,t)}(["icewalk","waterwalk","firewalk","forestwalk"],{MouseEvent:{inputModes:{edit:["ice","number","clear","info-line"],play:["line","peke","info-line"]},mouseinput_auto:function(){var e;this.puzzle.playmode?("left"===this.btn?this.mousestart||this.mousemove?this.inputLine():this.mouseend&&this.notInputted()&&(this.prevPos.reset(),this.inputpeke()):"right"===this.btn&&(this.mousestart||this.mousemove)&&this.inputpeke(),"firewalk"===this.pid&&this.mouseend&&this.notInputted()&&(this.prevPos.reset(),this.inputdot(),this.notInputted()&&this.toggleArcs())):this.puzzle.editmode&&(e=this.getcell(),"right"!==this.btn||e.isNum()||!this.mousestart&&!this.mousemove?this.mouseend&&this.notInputted()&&this.inputqnum():this.inputIcebarn())}},"MouseEvent@waterwalk":{inputModes:{edit:["water","number","clear","info-line"],play:["line","peke","info-line"]},mouseinput_other:function(){"water"===this.inputMode&&this.inputIcebarn()}},"MouseEvent@forestwalk":{inputModes:{edit:["forest","number","clear","info-line"],play:["line","peke","info-line"]},mouseinput_other:function(){"forest"===this.inputMode&&this.inputIcebarn()}},"MouseEvent@firewalk":{inputModes:{edit:["fire","number","clear","info-line"],play:["line","peke","dot","info-line"]},mouseinput_other:function(){"fire"===this.inputMode?this.inputIcebarn():"dot"===this.inputMode&&this.inputdot()},inputdot:function(){var e=this.getpos(.25);if(!this.prevPos.equals(e)){var t=e.getDot();if(this.prevPos=e,null!==t){if(null===this.inputData)if("left"===this.btn)this.inputData={0:2,1:0,2:1}[t.getDot()];else{if("right"!==this.btn)return;this.inputData={0:1,1:2,2:0}[t.getDot()]}t.setDot(this.inputData),t.draw()}}},toggleArcs:function(){var e=this.getcell();e.isnull||!e.ice()||e.lcnt<3&&!e.isLineCurve()||(2<e.lcnt?e.setQans(1!==e.qans?1:2):3===e.qans?e.updateFireQans():e.setQans(3),e.drawaround())},inputLine:function(){var e,t,i,n=this.getcell(),s=(this.initFirstCell(n),this.getpos(0));this.prevPos.equals(s)||((e=this.prevPos.getnb(s)).isnull||(null===this.inputData&&(this.inputData=e.isLine()?0:1),1===this.inputData?(e.setLine(),this.prevborder&&1===Math.abs(this.prevborder.bx-e.bx)&&1===Math.abs(this.prevborder.by-e.by)&&(i=e.isVert()?this.prevborder:e,t=e.isVert()?e:this.prevborder,(n=this.board.cellinside(Math.min(i.bx,t.bx),Math.min(i.by,t.by),Math.max(i.bx,t.bx),Math.max(i.by,t.by))[0])&&!n.isnull&&n.ice()&&(3<=n.lcnt||3===n.qans)&&(i=n.adjborder.top===i==(n.adjborder.left===t),n.setQans(i?1:2))),this.prevborder=e):0===this.inputData&&e.removeLine(),e.draw()),this.prevPos=s)},mousereset:function(){this.common.mousereset.call(this),this.prevborder=null}},KeyEvent:{enablemake:!0,keyinput:function(e){var t;"q"===e?((t=this.cursor.getc()).setQues(6!==t.ques?6:0),(this.prev=t).draw()):this.key_inputqnum(e)}},Border:{enableLineNG:!0,isLineNG:function(){return!this.inside},posthook:{line:function(e){this.board.scanResult=null,this.board.roommgr.isStale=!0;for(var t=0;t<=1;t++)this.sidecell[t].updateFireQans()}}},Cell:{updateFireQans:function(){},posthook:{qnum:function(e){-1!==e&&6===this.ques&&this.setQues(0)},ques:function(e){this.board.roommgr.isStale=!0,6===e&&this.setQnum(-1),this.updateFireQans()}},maxnum:function(){return this.board.cols*this.board.rows},ice:function(){return this.isnull||6===this.ques}},"Cell@firewalk":{updateFireQans:function(){var e;this.ice()&&this.isLineCurve()?(e=this.adjborder.top.isLine()===this.adjborder.left.isLine(),this.setQans(e?1:2)):(!this.ice()||this.lcnt<2||this.isLineStraight()||3===this.qans)&&this.setQans(0)}},Cross:{l2cnt:0},"Dot@firewalk":{getDot:function(){return"cross"===this.piece.group?this.piece.qsub:0},setDot:function(e){"cross"===this.piece.group&&(this.puzzle.opemgr.disCombine=!0,this.piece.setQsub(e),this.puzzle.opemgr.disCombine=!1)},getTrial:function(){return this.piece.trial}},Board:{hasborder:2,scanResult:null,scanInside:function(){if(null!==this.scanResult)return this.scanResult;if(this.cell.some(function(e){return 1===e.lcnt&&3===e.lcnt}))return this.scanResult=!1;for(var e=2;e<this.maxby;e+=2)for(var t=!1,i=1;i<this.maxbx;i+=2)this.getb(i,e).isLine()&&(t^=!0),this.getx(i+1,e).inside=t;return this.scanResult=!0},rebuildInfo:function(){this.scanResult=null,this.common.rebuildInfo.call(this)}},"Board@firewalk":{hasdots:1},"BoardExec@firewalk":{adjustBoardData:function(e,t){if(e&this.TURNFLIP)for(var i=this.board.cell,n=0;n<i.length;n++){var s=i[n];s.qans={0:0,1:2,2:1,3:3}[s.qans]}}},Graphic:{irowake:!0,bgcellcolor_func:"icebarn",paint:function(){this.drawBGCells(),this.drawDashedGrid(!1),this.drawBorders(),this.drawLines(),this.drawPekes(),this.drawQuesNumbers(),"firewalk"===this.pid&&this.drawDots(),this.drawTarget()},getBorderColor:function(e){var t=e.sidecell[0],e=e.sidecell[1];return t.ice()^e.ice()?this.quescolor:null}},"Graphic@waterwalk":{icecolor:"rgb(163, 216, 255)"},"Graphic@forestwalk":{icecolor:"rgb(195, 253, 186)"},"Graphic@firewalk":{icecolor:"rgb(255, 192, 192)",solvercolor:"rgb(193,125,145)",solverqanscolor:"rgb(133,9,82)",getDotFillColor:function(e){return 1===e.getDot()?e.getTrial()?this.trialcolor:this.pekecolor:2===e.getDot()?"white":null},getDotOutlineColor:function(e){return 2===e.getDot()?e.getTrial()?this.trialcolor:this.pekecolor:null},getDotRadius:function(e){return.15},drawLines:function(){this.common.drawLines.call(this),this.drawArcBackground(),this.drawArcCorners()},drawArcBackground:function(){for(var e=this.vinc("arc_back","crispEdges"),t=this.range.borders.cellinside(),i=this.lw,n=this.bw/2,s=0;s<t.length;s++){var r=t[s],o=r.qans,l=(11===r.qansBySolver?o=1:12===r.qansBySolver&&(o=2),r.adjborder),c=l.top.isLine()||l.top.isLineBySolver(),a=l.bottom.isLine()||l.bottom.isLineBySolver(),h=l.left.isLine()||l.left.isLineBySolver(),l=l.right.isLine()||l.right.isLineBySolver(),u=(c?1:0)+(a?1:0)+(h?1:0)+(l?1:0),d=2==u&&r.ice()||13<=r.qansBySolver&&r.qansBySolver<=16,d=0<o||d?this.getBGCellColor(r):null;e.vid="c_arc_bg_"+r.id,d?(e.fillStyle=d,4==u?e.fillRectCenter(r.bx*this.bw,r.by*this.bh,this.bw-i,this.bh-i):3===r.qans?e.fillRectCenter(r.bx*this.bw,r.by*this.bh,this.bw/2,this.bh/2):(d=1===o&&c&&h||13===r.qansBySolver,u=2===o&&c&&l||14===r.qansBySolver,c=2===o&&a&&h||15===r.qansBySolver,l=d||c?(r.bx-1)*this.bw-i+n:r.bx*this.bw+i-n,o=d||u?(r.by-1)*this.bh-i+n:r.by*this.bh+i-n,a=this.bw+n-2*i,h=this.bh+n-2*i,e.fillRect(l,o,a,h))):e.vhide()}},drawArcCorners:function(){for(var e=this.vinc("arcs","auto",!0),t=(e.lineWidth=2*this.lm,this.bw),i=this.range.borders.cellinside(),n=0;n<i.length;n++)for(var s=i[n],r=s.qans,o=(11===s.qansBySolver?r=1:12===s.qansBySolver&&(r=2),s.adjborder),l=o.top.isLine()||o.top.isLineBySolver(),c=o.bottom.isLine()||o.bottom.isLineBySolver(),a=o.left.isLine()||o.left.isLineBySolver(),h=o.right.isLine()||o.right.isLineBySolver(),u=(s.bx-1)*this.bw,d=(s.by-1)*this.bh,f=(s.bx+1)*this.bw,b=(s.by+1)*this.bh,p=0;p<4;p++){var k=null;switch(p){case 0:k=1===r&&l&&a||13===s.qansBySolver?o.top:null;break;case 1:k=2===r&&l&&h||14===s.qansBySolver?o.top:null;break;case 2:k=1===r&&c&&h||16===s.qansBySolver?o.bottom:null;break;case 3:k=2===r&&c&&a||15===s.qansBySolver?o.bottom:null}e.vid="c_arc_"+p+"_"+s.id;var g=k?this.getLineColor(k):null;if(g){switch(e.beginPath(),e.strokeStyle=g,p){case 0:e.arc(u,d,t,0,Math.PI/2);break;case 1:e.arc(f,d,t,Math.PI/2,Math.PI);break;case 2:e.arc(f,b,t,Math.PI,1.5*Math.PI);break;case 3:e.arc(u,b,t,1.5*Math.PI,2*Math.PI)}e.stroke()}else e.vhide()}}},LineGraph:{enabled:!0},"LineGraph@icewalk":{isLineCross:!0},"LineGraph@firewalk":{relation:{"border.line":"link","cell.qans":"arcs"},isLineCross:!0,modifyOtherInfo:function(e,t){var i=this.getObjNodeList(e);if(2===i.length){for(var n={},s=0;s<i.length;s++)for(;0<i[s].nodes.length;){var r=i[s].nodes[0];this.removeEdge(i[s],r),n[l=e.getdir(r.obj,2)]=r}for(var o=[e.DN,e.LT,e.RT,e.DN][e.qans],l=1;l<=4;l++)n[l]&&(l===e.UP||l===o?this.addEdge(i[0],n[l]):this.addEdge(i[1],n[l]))}},getSideNodesByLinkObj:function(e){for(var t=[],i=this.getSideObjByLinkObj(e),n=0;n<i.length;n++){var s=i[n],r=this.getObjNodeList(s),o=r[0];if(r[1]){var l=s.getdir(e,1);switch(s.qans){case 1:l!==e.DN&&l!==e.RT||(o=r[1]);break;case 2:l!==e.DN&&l!==e.LT||(o=r[1]);break;default:e.isvert&&(o=r[1])}}t.push(o)}return t},usesSecondNode:function(e,t){var i=[e.DN,e.LT,e.RT,e.DN][e.qans],t=e.getdir(t,2);return t===e.UP||t===i}},AreaRoomGraph:{countprop:"l2cnt",enabled:!0,relation:{"cell.ques":"node","border.line":"separator"},isedgevalidbylinkobj:function(e){return!!e.isLine()&&e.sidecell[0].ice()===e.sidecell[1].ice()}},Encode:{decodePzpr:function(){this.decodeIce(),this.decodeNumber16(),this.puzzle.setConfig("loop_full",this.checkpflag("f"))},encodePzpr:function(){this.outpflag=this.puzzle.getConfig("loop_full")?"f":null,this.encodeIce(),this.encodeNumber16()}},FileIO:{decodeData:function(){this.decodeConfigFlag("f","loop_full"),this.decodeCell(function(e,t){"A"===t?(e.ques=6,e.qans=1):"B"===t?(e.ques=6,e.qans=2):"C"===t?(e.ques=6,e.qans=3):"#"===t?e.ques=6:"-"===t?e.qnum=-2:"."!==t&&(e.qnum=+t)}),this.decodeBorderLine(),"firewalk"===this.pid&&this.decodeCross(function(e,t){e.qsub=+t})},encodeData:function(){this.encodeConfigFlag("f","loop_full"),this.encodeCell(function(e){return 0<e.qans?String.fromCharCode(64+e.qans)+" ":6===e.ques?"# ":-2===e.qnum?"- ":0<=e.qnum?e.qnum+" ":". "}),this.encodeBorderLine(),"firewalk"===this.pid&&this.board.cross.some(function(e){return e.qsub})&&this.encodeCross(function(e){return e.qsub+" "})}},AnsCheck:{checklist:["checkBranchLine","checkCrossLine@!icewalk","checkCrossOutOfIce@icewalk","checkIceLines@icewalk","checkWaterWalk@waterwalk","checkStraightOnFire@firewalk","checkLessWalk","checkOverWalk","checkForestCell@forestwalk","checkOneLoop","checkDoubleTurnOutside@firewalk","checkNoLineOnNum","checkNoLineIfVariant","checkDeadendLine+"],checkLessWalk:function(){this.checkWalkLength(-1,"bkSizeLt")},checkOverWalk:function(){this.checkWalkLength(1,"bkSizeGt")},checkWaterWalk:function(){this.checkWalkLength(2,"bkSizeGt2")},checkWalkLength:function(e,t){this.board.roommgr.isStale&&(this.board.roommgr.isStale=!1,this.board.roommgr.rebuild());for(var i=0;i<this.board.cell.length;i++){var n=this.board.cell[i],s=n.qnum;if(2===e){if(!n.ice())continue;s=2}if(!(s<=0)&&n.room&&!(e<0&&n.room.clist.some(function(e){return 2!==e.lcnt}))){var r=n.room.clist.length;if(0<e?s<r:r<s){if(this.failcode.add(t),this.checkOnly)return;n.room.clist.seterr(1)}}}},checkCrossOutOfIce:function(){this.checkAllCell(function(e){return 4===e.lcnt&&!e.ice()},"lnCrossExIce")},checkNoLineOnNum:function(){this.checkAllCell(function(e){return-1!==e.qnum&&0===e.lcnt},"lnIsolate")}},"AnsCheck@firewalk":{checkBranchLine:function(){this.checkAllCell(function(e){return 3===e.lcnt&&0===e.qans},"lnBranch")},checkCrossLine:function(){this.checkAllCell(function(e){return 4===e.lcnt&&0===e.qans},"lnCross")},checkDeadendLine:function(){this.checkAllCell(function(e){return 1===e.lcnt||3===e.qans||3===e.lcnt&&0<e.qans},"lnDeadEnd")},checkStraightOnFire:function(){this.checkAllCell(function(e){return 2<=e.lcnt&&e.ice()&&0===e.qans},"lnStraightOnIce")},checkDoubleTurnOutside:function(){this.board.scanInside()&&this.checkAllCell(function(e){return 4===e.lcnt&&(1===e.qans&&e.relcross(-1,-1).inside||2===e.qans&&e.relcross(1,-1).inside)},"lnDoubleTurn")}},"AnsCheck@forestwalk":{checkBranchLine:function(){this.checkAllCell(function(e){return 3===e.lcnt&&!e.ice()},"lnBranch")},checkForestCell:function(){this.checkAllCell(function(e){return 0<e.lcnt&&e.lcnt<3&&e.ice()},"lnNoBranch")}}});