/*! @license pzpr.js v1375cc80 (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */
!function(e,o){"object"==typeof module&&module.exports?module.exports=[e,o]:pzpr.classmgr.makeCustom(e,o)}(["heyawake","ayeheya","oneroom","akichi","sumiwake"],{MouseEvent:{RBShadeCell:!0,use:!0,inputModes:{edit:["border","number","clear","info-blk"],play:["shade","unshade","peke","info-blk"]},autoedit_func:"areanum",autoplay_func:"cellpeke"},"MouseEvent@sumiwake":{inputModes:{edit:["border","clear","info-blk"],play:["shade","unshade","peke","info-blk"]},mouseinputAutoEdit:function(){this.mousestart||this.mousemove?this.inputborder():this.mouseend&&this.notInputted()&&this.inputqnum_cross()}},KeyEvent:{enablemake:!0},"KeyEvent@sumiwake":{moveTarget:function(e){return this.moveTCross(e)},keyinput:function(e){this.key_inputcross(e)}},Cell:{maxnum:function(){return Math.min(999,this.room.clist.length)},minnum:0},"Cell@akichi":{maxnum:function(){return this.room.clist.length}},"Cross@sumiwake":{disInputHatena:!0,maxnum:2},Board:{hasborder:1},"Board@sumiwake":{hascross:2},"TargetCursor@sumiwake":{crosstype:!0},"Board@oneroom,akichi":{addExtraInfo:function(){this.unshrgraph=this.addInfoList(this.klass.AreaUnshadeRoomGraph)}},AreaUnshadeGraph:{enabled:!0},AreaRoomGraph:{enabled:!0,hastop:!0,allborderlist:null,setExtraData:function(e){this.common.setExtraData.call(this,e),this.allborderlist=null},getAllBorders:function(){if(this.allborderlist)return this.allborderlist;for(var t=this,n=this.components.length,e=0;e<n;e++)this.components[e].id=e;var r={};return this.board.border.each(function(e){var o,i;e&&!e.isnull&&e.isBorder()&&(o=t.getComponentRefs(e.sidecell[0]),i=t.getComponentRefs(e.sidecell[1]),o&&i&&((i=""+(o.id<i.id?o.id*n+i.id:i.id*n+o.id))in r||(r[i]=new t.klass.BorderList),r[i].add(e)))}),this.allborderlist=r}},"AreaRoomGraph@sumiwake":{hastop:!1},"AreaUnshadeRoomGraph:AreaUnshadeGraph@oneroom,akichi":{enabled:!0,relation:{"cell.qans":"node","border.ques":"separator"},setComponentRefs:function(e,o){e.unshr=o},getObjNodeList:function(e){return e.unshrnodes},resetObjNodeList:function(e){e.unshrnodes=[]},isedgevalidbylinkobj:function(e){return!e.isBorder()}},Graphic:{gridcolor_type:"LIGHT",enablebcolor:!0,paint:function(){this.drawBGCells(),this.drawGrid(),this.drawShadedCells(),this.drawDotCells(),this.drawQuesNumbers(),this.drawBorders(),this.drawChassis(),this.drawBoxBorders(!1),this.drawPekes(),"sumiwake"===this.pid&&this.drawCrosses(),this.drawTarget()},getBorderColor:function(e){return e.ques?1===e.error?this.errcolor1:this.quescolor:null}},"Graphic@sumiwake":{gridcolor_type:"",shadecolor:"#222222",margin:.5,crosssize:.33,drawCrosses:function(){for(var e=this.vinc("cross_base","auto",!0),o=this.cw*this.crosssize+1,i=(e.lineWidth=2.5,this.range.crosses),t=0;t<i.length;t++){var n=i[t],r=n.bx*this.bw,s=n.by*this.bh;e.vid="x_cp_"+n.id,e.strokeStyle=1===n.error||1===n.qinfo?this.errcolor1:"black",1===n.qnum?(e.fillStyle=null,e.shapeCircle(r,s,o)):2===n.qnum?(e.fillStyle=e.strokeStyle,e.shapeCircle(r,s,o)):e.vhide()}}},Encode:{decodePzpr:function(e){this.decodeConfig(),this.decodeBorder(),this.decodeRoomNumber16()},encodePzpr:function(e){this.encodeConfig(),this.encodeBorder(),this.encodeRoomNumber16()},decodeKanpen:function(){this.fio.decodeSquareRoom()},encodeKanpen:function(){this.fio.encodeSquareRoom()},decodeConfig:function(){},encodeConfig:function(){},decodeHeyaApp:function(){for(var e=0,o=[],i=this.board,e=0;e<i.cell.length;e++)o[e]=null;for(var t=new this.puzzle.klass.FileIO,n=0,r=this.outbstr.split("/"),e=0;e<i.cell.length;e++)if(null===o[e]){var s=i.cell[e];if(r[n].match(/((\d+)in)?(\d+)x(\d+)$/)){0<RegExp.$2.length&&(s.qnum=+RegExp.$2);for(var c=s.bx,a=c+2*+RegExp.$3-2,d=s.by,h=d+2*+RegExp.$4-2,l=c;l<=a;l+=2)for(var u=d;u<=h;u+=2)o[i.getc(l,u).id]=n}n++}t.rdata2Border(!0,o)},encodeHeyaApp:function(){for(var e=[],o=this.board,i=o.roommgr.components,t=0;t<i.length;t++){var n=i[t].clist.getRectSize(),r=o.getc(n.x1,n.y1).qnum;e.push((0<=r?r+"in":"")+n.cols+"x"+n.rows)}this.outbstr=e.join("/")}},"Encode@akichi":{decodeConfig:function(){this.puzzle.setConfig("akichi_maximum",this.checkpflag("x"))},encodeConfig:function(){this.outpflag=this.puzzle.getConfig("akichi_maximum")?"x":null}},"Encode@sumiwake":{decodePzpr:function(e){this.decode4Cross(),this.decodeBorder()},encodePzpr:function(e){this.encode4Cross(),this.encodeBorder()}},FileIO:{decodeData:function(){this.decodeConfig(),this.decodeAreaRoom(),"sumiwake"===this.pid?this.decodeCrossNum():this.decodeCellQnum(),this.decodeCellAns(),this.decodeBorderLine()},encodeData:function(){this.encodeConfig(),this.encodeAreaRoom(),"sumiwake"===this.pid?this.encodeCrossNum():this.encodeCellQnum(),this.encodeCellAns(),this.encodeBorderLineIfPresent()},decodeConfig:function(){},encodeConfig:function(){},kanpenOpen:function(){this.decodeSquareRoom(),this.decodeCellAns()},kanpenSave:function(){this.encodeSquareRoom(),this.encodeCellAns()},decodeSquareRoom:function(){for(var e,o=this.board,i=[],t=0,n=+this.readLine();t<n&&(e=this.readLine());t++){for(var r=e.split(" "),s=0;s<4;s++)isNaN(r[s])||(r[s]=2*+r[s]+1);""!==r[4]&&(o.getc(r[1],r[0]).qnum=+r[4]),o.cellinside(r[1],r[0],r[3],r[2]).each(function(e){i[e.id]=t})}this.rdata2Border(!0,i),o.roommgr.rebuild()},encodeSquareRoom:function(){var e=this.board,o=(e.roommgr.rebuild(),e.roommgr.components);this.writeLine(o.length);for(var i=0;i<o.length;i++){var t=o[i].clist.getRectSize(),n=o[i].top.qnum;this.writeLine([t.y1>>1,t.x1>>1,t.y2>>1,t.x2>>1,0<=n?""+n:""].join(" "))}},kanpenOpenXML:function(){this.decodeSquareRoom_XMLBoard(),this.decodeCellAns_XMLAnswer()},kanpenSaveXML:function(){this.encodeSquareRoom_XMLBoard(),this.encodeCellAns_XMLAnswer()},decodeSquareRoom_XMLBoard:function(){for(var e=this.xmldoc.querySelectorAll("board area"),o=this.board,i=[],t=0;t<e.length;t++){var n=e[t],r=2*+n.getAttribute("c0")-1,s=2*+n.getAttribute("r0")-1,c=2*+n.getAttribute("c1")-1,a=2*+n.getAttribute("r1")-1,n=+n.getAttribute("n");0<=n&&(o.getc(r,s).qnum=n);for(var d=r;d<=c;d+=2)for(var h=s;h<=a;h+=2)i[o.getc(d,h).id]=t}this.rdata2Border(!0,i),o.roommgr.rebuild()},encodeSquareRoom_XMLBoard:function(){for(var e=this.xmldoc.querySelector("board"),o=this.board,i=(o.roommgr.rebuild(),o.roommgr.components),t=0;t<i.length;t++){var n=i[t].clist.getRectSize(),r=i[t].top.qnum;e.appendChild(this.createXMLNode("area",{r0:1+(n.y1>>1),c0:1+(n.x1>>1),r1:1+(n.y2>>1),c1:1+(n.x2>>1),n:r}))}}},"FileIO@akichi":{decodeConfig:function(){this.decodeConfigFlag("x","akichi_maximum")},encodeConfig:function(){this.encodeConfigFlag("x","akichi_maximum")}},AnsCheck:{checklist:["checkShadeCellExist","checkAdjacentShadeCell","checkConnectUnshadeRB","checkRegionDivided@oneroom","checkFractal@ayeheya","checkShadeCellCount@!akichi","checkQnumOverOne@sumiwake","checkQnumUnderOne@sumiwake","checkQnumTwo@sumiwake","checkAttainedSize@akichi","checkUnshadedSize@akichi","checkOneDoor@oneroom","checkCountinuousUnshadeCell@!oneroom","checkRoomSymm@ayeheya","doneShadingDecided"],checkFractal:function(){var e=this.board.roommgr.components;e:for(var o=0;o<e.length;o++)for(var i=e[o].clist,t=i.getRectSize(),n=t.x1+t.x2,r=t.y1+t.y2,s=0;s<i.length;s++){var c=i[s],a=this.board.getc(n-c.bx,r-c.by);if(c.isShade()!==a.isShade()){if(this.failcode.add("bkNotSymShade"),this.checkOnly)break e;i.seterr(1)}}},checkRoomSymm:function(){var e=this.board.roommgr.components;e:for(var o=0;o<e.length;o++)for(var i=e[o].clist,t=i.getRectSize(),n=t.x1+t.x2,r=t.y1+t.y2,s=0;s<i.length;s++){var c=i[s],c=this.board.getc(n-c.bx,r-c.by);if(c.room!==e[o]){if(this.failcode.add("bkNotSymRoom"),this.checkOnly)break e;i.seterr(1)}}},checkCountinuousUnshadeCell:function(){var e=this.checkOnly;this.checkOnly=!0,this.checkRowsColsPartly(this.isBorderCount,function(e){return e.isShade()},"bkUnshadeConsecGt3"),this.checkOnly=e},isBorderCount:function(e){var o,i,t=e.getRectSize(),n=0,r=this.board;if(t.x1===t.x2)for(o=t.x1,i=t.y1+1;i<=t.y2-1;i+=2)r.getb(o,i).isBorder()&&n++;else if(t.y1===t.y2)for(i=t.y1,o=t.x1+1;o<=t.x2-1;o+=2)r.getb(o,i).isBorder()&&n++;var s=n<=1;return s||e.seterr(1),s}},"AnsCheck@oneroom":{checkRegionDivided:function(){for(var e=this.board.roommgr.components,o=this.board.unshrgraph.components,i=0;i<e.length;i++)e[i].unshrcount=0;for(i=0;i<o.length;i++)o[i].clist[0].room.unshrcount++;for(i=0;i<e.length;i++)if(!(e[i].unshrcount<=1)){if(this.failcode.add("bkSubdivided"),this.checkOnly)break;e[i].clist.filter(function(e){return!e.isShade()}).seterr(1)}},checkOneDoor:function(){var e,o=this.board.roommgr.getAllBorders();for(e in o){var i=o[e].filter(function(e){return!e.sidecell[0].isShade()&&!e.sidecell[1].isShade()});if(!(i.length<=1)){if(this.failcode.add("bdDoorsGt"),this.checkOnly)break;i.each(function(e){e.seterr(1),e.sidecell[0].seterr(1),e.sidecell[1].seterr(1)})}}}},"AnsCheck@akichi":{checkAttainedSize:function(){if(!this.puzzle.getConfig("akichi_maximum")){for(var e=this.board.roommgr.components,o=this.board.unshrgraph.components,i=0;i<e.length;i++)e[i].isMaxFound=e[i].top.qnum<=0;for(i=0;i<o.length;i++){var t=o[i].clist.length;t&&(t>=(t=o[i].clist[0].room).top.qnum&&(t.isMaxFound=!0))}for(i=0;i<e.length;i++)if(!e[i].isMaxFound){if(this.failcode.add("cuRoomLt"),this.checkOnly)break;e[i].clist.seterr(1)}}},checkUnshadedSize:function(){for(var e=this.board.unshrgraph.components,o=0;o<e.length;o++){var i=e[o].clist.length;if(i){var t=e[o].clist[0].room.top.qnum;if(!(t<0||i<=t)){if(this.failcode.add("cuRoomGt"),this.checkOnly)break;e[o].clist.seterr(1)}}}}},"AnsCheck@sumiwake":{checkQnumUnderOne:function(){this.checkQnumCross(1,"csLt1")},checkQnumOverOne:function(){this.checkQnumCross(2,"csGt1")},checkQnumTwo:function(){this.checkQnumCross(3,"csLt2")},checkQnumCross:function(e,o){for(var i=this.board,t=0;t<i.cross.length;t++){var n=i.cross[t],r=n.qnum;if(r===(3===e?2:1)){var s=n.bx,c=n.by,s=i.cellinside(s-1,c-1,s+1,c+1),c=s.filter(function(e){return e.isShade()}).length;if(!(2===e?c<=r:r<=c)){if(this.failcode.add(o),this.checkOnly)break;n.seterr(1),s.seterr(1)}}}}}});